<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprende con Douglas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f1f1;
            color: #333;
            background-image: url('https://images.unsplash.com/photo-1549057442-5f6531557007?q=80&w=1974&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }
        .header-content {
            background-color: #1a2;
            color: #fff;
            border-bottom-left-radius: 16px;
            border-bottom-right-radius: 16px;
            box-shadow: 0 4px 116px rgba(0, 0, 0, 0.1);
        }
        .footer-content {
            background-color: #1a202c;
            color: #fff;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.1);
        }
        .card {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .module-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .module-card:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        
        #progress-bar {
            transition: width 0.5s ease-in-out;
        }

        /* Modal */
        .modal {
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        /* Intro Overlay */
        #intro-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 2rem;
            border-radius: 12px;
        }

        /* Matching Game Styles */
        .card-game {
            width: 120px;
            height: 120px;
            perspective: 1000px;
            cursor: pointer;
            position: relative;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .card-game.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .card-front {
            background-color: #4f46e5;
            color: white;
            transform: rotateY(0deg);
        }

        .card-back {
            background-color: #6366f1;
            color: white;
            transform: rotateY(180deg);
        }
    </style>
</head>
<header class="w-full py-4 text-center header-content mb-8">
    <h1 class="text-3xl sm:text-4xl font-bold">
        <i class="fas fa-graduation-cap mr-3"></i>Aprende con Douglas</h1>
        </div>
        <h2 class="text-2xl sm:text-3xl font-bold">Curso Completo de Inglés Básico</h2>

        <p class="text-sm sm:text-base text-back-400 mt-2">¡Aprende y practica a tu ritmo!</p>
        </div>
    </header>

    <main id="app-container" class="container mx-auto mt-8 p-4">

        <div id="main-menu" class="space-y-8">
            <div id="intro-overlay" class="text-center">
                <h2 class="text-4xl font-bold text-white">¡Te damos la bienvenida!</h2>
                <p class="text-xl text-green-100 mt-2">¡Esperamos que disfrutes de tu experiencia de aprendizaje en esta Aula Virtual!</p>
            </div>
            <div id="module-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
            
            <div class="flex justify-center mt-8 space-x-4">
                <button id="share-button" class="bg-green-500 text-white py-2 px-4 rounded-full hover:bg-green-600 transition duration-300">
                    <i class="fas fa-share-alt text-sm mr-2"></i> Compartir curso
                </button>
                <div id="admin-button-container">
                    <button id="admin-button" class="bg-blue-500 text-white py-2 px-4 rounded-full hover:bg-blue-600 transition duration-300">
                        <i class="fas fa-lock text-sm mr-2"></i> Admin
                    </button>
                </div>
                <div id="admin-panel" class="hidden">
                    <button id="change-password-button" class="bg-purple-500 text-white py-2 px-4 rounded-full hover:bg-purple-600 transition duration-300">
                        <i class="fas fa-key text-sm mr-2"></i> Cambiar Contraseña
                    </button>
                </div>
            </div>
        </div>

        <div id="module-view" class="hidden space-y-6">
            <div class="text-center">
                <button onclick="showMainMenu()" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-full hover:bg-gray-300 transition duration-300 transform hover:scale-105 inline-flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i> Volver a Módulos
                </button>
                <h2 id="module-title" class="text-4xl font-bold mt-4"></h2>
                <p id="module-description" class="text-lg text-gray-600 mt-2"></p>
                <div id="module-media" class="mt-4"></div>
            </div>
            <div id="lesson-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
        </div>

        <div id="lesson-template" class="hidden lesson-view">
            <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <button id="back-to-modules-button" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-full hover:bg-gray-300 transition duration-300 transform hover:scale-105 inline-flex items-center mb-4">
                        <i class="fas fa-arrow-left mr-2"></i> Volver al Módulo
                    </button>
                    <h2 id="lesson-title" class="text-3xl font-bold text-gray-800 mb-4"></h2>
                    <div id="lesson-media-container" class="flex flex-wrap items-center gap-4 mb-4"></div>
                    <div id="lesson-content" class="prose max-w-none text-gray-700"></div>
                    <div class="mt-8 text-center">
                        <button id="show-quiz-button" class="bg-blue-500 text-white py-3 px-8 rounded-full font-semibold hover:bg-blue-600 transition duration-300 transform hover:scale-105">
                            Realizar Cuestionario
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="quiz-template" class="hidden quiz-view">
            <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <button id="back-to-lesson-button" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-full hover:bg-gray-300 transition duration-300 transform hover:scale-105 inline-flex items-center mb-4">
                        <i class="fas fa-arrow-left mr-2"></i> Volver a la lección
                    </button>
                    <h2 id="quiz-title" class="text-3xl font-bold text-gray-800 mb-4"></h2>
                    <div id="progress-container" class="relative pt-1 mb-4">
                        <div class="flex mb-2 items-center justify-between">
                            <div>
                                <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full bg-blue-200 text-blue-600">
                                    Progreso
                                </span>
                            </div>
                            <div class="text-right">
                                <span id="progress-text" class="text-xs font-semibold inline-block text-blue-600">
                                    0/0
                                </span>
                            </div>
                        </div>
                        <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-blue-200">
                            <div id="progress-bar" style="width:0%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"></div>
                        </div>
                    </div>
                    <div id="timer-container" class="text-center mb-4">
                    </div>
                    <div id="quiz-questions">
                        </div>
                    <div id="feedback-message" class="mt-4 text-center text-lg font-bold min-h-[1.5rem]"></div>
                    <div id="quiz-results" class="text-center hidden">
                        <h3 class="text-2xl font-bold text-gray-800">Cuestionario Finalizado</h3>
                        <p id="score-text" class="text-xl mt-2"></p>
                        <div class="mt-4">
                            <button onclick="showMainMenu()" class="bg-green-500 text-white py-2 px-6 rounded-full font-semibold hover:bg-green-600 transition duration-300 transform hover:scale-105">
                                Volver al Menú Principal
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="matching-game-template" class="hidden text-center space-y-6">
            <button onclick="showMainMenu()" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-full hover:bg-gray-300 transition duration-300 transform hover:scale-105 inline-flex items-center">
                <i class="fas fa-arrow-left mr-2"></i> Volver a Módulos
            </button>
            <h2 class="text-3xl font-bold text-white drop-shadow-lg">Juego de Memoria</h2>
            <p class="text-white drop-shadow-lg">¡Haz clic en las cartas para encontrar los pares de palabras!</p>
            <div id="card-container" class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 gap-4 justify-center items-center">
                </div>
        </div>

        <div id="blocked-modal" class="modal fixed inset-0 z-50 flex items-center justify-center hidden">
            <div class="bg-white p-8 rounded-lg shadow-lg text-center">
                <h3 class="text-2xl font-bold text-red-500 mb-4">Módulo Bloqueado</h3>
                <p class="text-gray-700">Este módulo está actualmente bloqueado. Por favor, completa los módulos anteriores para desbloquearlo.</p>
                <div class="mt-6">
                    <button onclick="hideBlockedMessage()" class="bg-red-500 text-white py-2 px-6 rounded-full font-semibold hover:bg-red-600 transition duration-300">
                        Entendido
                    </button>
                </div>
            </div>
        </div>

        <div id="admin-modal" class="modal fixed inset-0 z-50 flex items-center justify-center hidden">
            <div class="bg-white p-8 rounded-lg shadow-lg text-center w-full max-w-md">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Acceso de Administrador</h3>
                <input type="password" id="admin-password-input" placeholder="Ingresa la contraseña" class="w-full px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
                <button id="unlock-button" class="bg-blue-500 text-white py-2 px-6 rounded-full font-semibold hover:bg-blue-600 transition duration-300">
                    Desbloquear
                </button>
                <p id="admin-message" class="hidden"></p>
                <div class="mt-4">
                    <button onclick="hideAdminModal()" class="text-gray-500 hover:text-gray-700">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>

        <div id="change-password-modal" class="modal fixed inset-0 z-50 flex items-center justify-center hidden">
            <div class="bg-white p-8 rounded-lg shadow-lg text-center w-full max-w-md">
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Cambiar Contraseña</h3>
                <input type="password" id="old-password-input" placeholder="Contraseña actual" class="w-full px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 mb-4">
                <input type="password" id="new-password-input" placeholder="Nueva contraseña" class="w-full px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 mb-4">
                <input type="password" id="confirm-password-input" placeholder="Confirmar nueva contraseña" class="w-full px-4 py-2 border rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 mb-4">
                <button id="save-password-button" class="bg-purple-500 text-white py-2 px-6 rounded-full font-semibold hover:bg-purple-600 transition duration-300">
                    Guardar
                </button>
                <p id="password-change-message" class="hidden"></p>
                <div class="mt-4">
                    <button onclick="hidePasswordModal()" class="text-gray-500 hover:text-gray-700">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="w-full py-4 text-center footer-content mt-8">
        <p class="text-gray-400">© 2025 Aprende con Douglas. Todos los derechos reservados. Caracas, Venezuela.</p>
        <p class="mt-2"> Contacto: Prof. Douglas A. García P. 0426-186-7736 email: <a href="mailto:edutic.capital@gmail.com" class="text-blue-400 hover:underline"> edutic.capital@gmail.com</a></p>
        <div class="flex justify-center mt-2 space-x-4 text-gray-800">
    </footer>
    
    <script>
        // Funciones de cifrado y descifrado
        function encrypt(text, key) {
            let result = '';
            for (let i = 0; i < text.length; i++) {
                result += String.fromCharCode(text.charCodeAt(i) ^ key.charCodeAt(i % key.length));
            }
            return btoa(result);
        }

        function decrypt(encryptedText, key) {
            let result = '';
            const decodedText = atob(encryptedText);
            for (let i = 0; i < decodedText.length; i++) {
                result += String.fromCharCode(decodedText.charCodeAt(i) ^ key.charCodeAt(i % key.length));
            }
            return result;
        }

        const modules = {
            'modulo-1-fundamentos-comunicacion': {
                title: 'Módulo 1: Los Fundamentos de la Comunicación',
                description: 'Aprende a comunicarte desde cero con saludos, despedidas y vocabulario esencial.',
                color: 'bg-indigo-600',
                media: {
                    image: 'https://cdn.pixabay.com/photo/2016/09/01/08/25/english-1635056_960_720.jpg', 
                },
                lessons: {
                    'saludos-despedidas': {
                        title: 'Saludos y Despedidas',
                        content: `
                            <h3 class="text-2xl font-semibold">Saludos comunes</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li><strong>Hello / Hi:</strong> Hola</li>
                                <li><strong>Good morning:</strong> Buenos días</li>
                                <li><strong>Good afternoon:</strong> Buenas tardes</li>
                                <li><strong>Good evening:</strong> Buenas noches (saludo)</li>
                            </ul>
                            <h3 class="text-2xl font-semibold mt-4">Despedidas comunes</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li><strong>Goodbye / Bye:</strong> Adiós</li>
                                <li><strong>Good night:</strong> Buenas noches (despedida)</li>
                                <li><strong>See you later:</strong> Nos vemos luego</li>
                                <li><strong>Take care:</strong> Cuídate</li>
                            </ul>
                        <a href="https://drive.google.com/uc?export=download&id=1npwlJdfuw7jhpMgyVTcA144qVsBJyzen" target="_blank" class="bg-blue-500 text-white py-2 px-6 rounded-full font-semibold hover:bg-blue-600 transition duration-300 transform hover:scale-105 inline-flex items-center">
                                    <i class="fas fa-download mr-2"></i> Descargar PDF de Saludos y Despedidas
                                </a>
                                <audio controls class="w-full md:w-1/2">
    <source src="https://archive.org/download/saludos-y-despedidas/Saludos y Despedidas.mp3" type="audio/mpeg">
    Tu navegador no soporta el elemento de audio.
    </audio>                                
    <p class="text-sm mt-2 text-gray-500">Audio: Saludos y Despedidas</p>
                            </div>
                        `,
                        quiz: [
                            { type: 'multiple-choice', question: '¿Cuál usarías para despedirte en la noche?', options: ['Good evening', 'Good night', 'Good morning'], answer: 'Good night' },
                            { type: 'true-false', question: '¿"Hi" y "Hello" tienen el mismo significado?', answer: true },
                            { type: 'fill-in-the-blank', question: 'Completa: "It\'s late, time to say _____."', answer: 'goodbye' },
                            { type: 'multiple-choice', question: 'Si es mediodía, ¿qué saludo es el más adecuado?', options: ['Good morning', 'Good afternoon', 'Good evening'], answer: 'Good afternoon' },
                            { type: 'true-false', question: '¿"Take care" significa "cuídate"?', answer: true },
                            { type: 'fill-in-the-blank', question: 'Completa: "I am going to the store, _____."', answer: 'see you later' }
                        ]
                    },
                    'pronombres-personales': {
                        title: 'Pronombres Personales (Personal Pronouns)',
                        content: `
                            <h3 class="text-2xl font-semibold">Concepto</h3>
                            <p>Son palabras que reemplazan a los sustantivos para referirse a una persona, animal o cosa.</p>
                            <h3 class="text-2xl font-semibold mt-4">Pronombres</h3>
                            <ul class="list-disc list-inside space-y-2">
                                <li><strong>I = </strong> yo - Para referirse a uno mismo.</li>
                                <li><strong>You = </strong> tú, usted, ustedes - Para referirse a la persona o personas con las que se habla. </li>
                                <li><strong>He = </strong> él - Para referirse a un hombre o chico. </li>
                                <li><strong>She = </strong> ella - Para referirse a una mujer o chica. </li>
                                <li><strong>It = </strong> eso - Para referirse a objetos, animales o situaciones, o en general para cosas en singular.</li>
                                <li><strong>We = </strong> nosotros/as - Para referirse a uno mismo y otras personas. </li>
                                <li><strong>They = </strong> ellos/as - Para referirse a un grupo de personas, animales u objetos. </li>
                            </ul>
                            <div class="mt-4 flex flex-wrap gap-2">
                                <a href="https://drive.google.com/uc?export=download&id=1jhGo_egJ2-VJjMBrsTZWKuxGfu-riLyG" target="_blank" class="bg-blue-500 text-white py-2 px-6 rounded-full font-semibold hover:bg-blue-600 transition duration-300 transform hover:scale-105 inline-flex items-center">
                                    <i class="fas fa-download mr-2"></i> Descargar lección
                                </a>
                                <audio controls class="w-full md:w-1/2">
                                    <source src="https://archive.org/download/pronombres_personales_curso/pronombres_personales_curso.mp3" type="audio/mpeg">
                                    Tu navegador no soporta el elemento de audio.
                                </audio>
                                <p class="text-sm mt-2 text-gray-500">Audio: Pronombres Personales</p>
                            </div>
                        `,
                        quiz: [
                            { type: 'multiple-choice', question: '¿Cuál es el pronombre para "ella"?', options: ['He', 'She', 'It'], answer: 'She' },
                            { type: 'true-false', question: '¿"You" solo se usa para singular?', answer: false },
                            { type: 'fill-in-the-blank', question: 'Completa la frase: "_____ are my friends." (Ellos)', answer: 'They' },
                            { type: 'multiple-choice', question: '¿Qué pronombre usarías para referirte a un perro?', options: ['He', 'It', 'She'], answer: 'It' },
                            { type: 'true-false', question: '¿"We" significa "tú y yo"?', answer: true },
                            { type: 'fill-in-the-blank', question: 'Completa la frase: "_____ is a good student." (Él)', answer: 'He' }

                        ]
                    },
                }
            },
            'modulo-2-sustantivos-adjetivos': {
                title: 'Módulo 2: Sustantivos y Adjetivos',
                description: 'Aprende los conceptos más básicos sobre los sustantivos, los adjetivos y los pronombres, el punto de partida perfecto para tu viaje por la gramática inglesa.',
                color: 'bg-red-500',
                lessons: {
                    'adjetivos-posesivos': {
                        title: 'Adjetivos Posesivos (Possessive Adjectives)',
                        content: 'PGgyIHRleHQtMnhsIGZvbnQtc2VtaWJvbGQ+Q29uY2VwdG88L2gzPjxwPkxvcyBhZGpldGl2b3MgcG9zZXNpdm9zIGluZGljYW4gYSDDumkgYSBxdWnDqW5lcyBsZSBwZXJ0ZW5lY2UgYWxnbzogU2UgdXNhbiBzaWVtcHJlIGp1bnRvIGEgdW4gc3VzdGFudGl2byAobm91bSkuPC9wPjxoMyBjbGFzcz0idGV4dC0yeGwgZm9udC1zZW1pYm9sZCBtdC00Ij5SZWdsYSBwcmluY2lwYWw8L2gzPjxwPlNlIGNvbG9jYW4gPHN0cm9uZz5hbnRlczwvc3Ryb25nPiBkZWwgc3VzdGFudGl2byBxdWUgZGVzY3JpYmVuLjwvcD48aDMgY2xhc3M9InRleHQtMnhsIGZvbnQtc2VtaWJvbGQgbXQtNCI+RWplbXBsb3Mga2V5PC9oMz48dWwgc3RhcnR1bz0iJyciIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgc3BhY2UteS0yIj48bGk+PHN0cm9uZz5NeTwvc3Ryb25nPiAobWkvbWlzKTogPHN0cm9uZz5NeTwvc3Ryb25nPiBuYW1lIGlzIEFuaS48L2xpPjxsaT48c3Ryb25nPVlvdXI8L3N0cm9uZz4gKHR1L3R1cyk6IDxzdHJvbmc+WW91cjwvc3Ryb25nPiBob3VzZSBpcyBiaWcuPC9saT48bGk+PHN0cm9uZz5IaXM8L3N0cm9uZz4gKHN1LCBkZSADDqWwpOiA8c3Ryb25nPkhpczwvc3Ryb25nPiBjYXIgaXMgcmVkLjwvbGk+PGxpPjxzdHJvbmc+SGVyPC9zdHJvbmc+IChzdSwgZGUgZWxsYSk6IDxzdHJvbmc+SGVyPC9zdHJvbmc+IGJhZyBpcyBzbWFsbC48L2xpPjxsaT48c3Ryb25nPkFpdHM8L3N0cm9uZz4gKHN1LCBkZSBlc28vYW5pbWFsKTogPHN0cm9uZz5JdHM8L3N0cm9uZz4gdGFpbCBpcyBsb25nLjwvbGk+PGxpPjxzdHJvbmc+T3Vycjwvc3Ryb25nPiAobnVlc3Ryby9hKTogPHN0cm9uZz5PdXI8L3N0cm9uZz4gZmFtaWx5IGlzIG5pY2UuPC9saT48bGk+PHN0cm9uZz5UaGVpcjwvc3Ryb25nPiAoc3UsIGRlIGVsbG9zL2FzKTogPHN0cm9uZz5UaGVpcjwvc3Ryb25nPiBkb2cgaXMgY3V0ZS48L2xpPjwvdWw+PGRpdiBjbGFzcz0ibXQtNCBmbGV4IGZsZXgtd3JhcCBnY-ItMiI+PGEgaHJlZj0iaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2V4cG9ydD1kb3dubG9hZCZpZD0xamhHby1lZ0oyLVZKangtVkpqTUIyc1RaV0t1eEdmdS1yaUx5RyIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJicmEtYmx1ZS01MDAgdGV4dC13aGl0ZSBweS0yIHB4LTYgcm91bmRlZC1mdWxsIGZvbnQtc2VtaWJvbGQgaG92ZXI6Ymd-Ymx1ZS02MDAgdHJhbnNpdGlvbiBkdXJhdGlvbi0zMDAgdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSBpbmluZS1mbGV4IGl0ZW1zLWNlbnRlcj48aSBjbGFzcz0iZmFzIGZhLWRvd25sb2FkIG1yLTIiPjwvaT4gRGVzY2FyZ2FyIGxlY2NpJjM0M248L2E+PGF1ZGlvIGNvbnRyb2xzIGNsYXNzPSJ3LWZ1bGwgbWQ6dy0xLzIiPjxzY29yY2Ugc3JjPSJodHRwczovL2FyY2hpdmUub3JnL2Rvd25sb2FkL3Byb25vbWJyZXNfcGVyc29uYWxlc19jdXJzby9wcm9ub21icmVzX3BlcnNvbmFsZXNfY3Vyc28ubXAzIiB0eXBlPSJhdWRpby9tcGVnIj5UeiBia3ZlZ2Fkb3Igbm8gc29wb3J0YSBlbCBlbGVtZW50byBkZSBhdWRpby48L2F1ZGlvPjxwIGNsYXNzPSJ0ZXh0LXNtIG10LTIgdGV4dC1ncmF5LTUwMCI+QXVkaW86IFByb25vbWJyZXMgUGVyc29uYWxlczwvcD48L2Rpdj4=',
                        quiz: [
                            { type: 'multiple-choice', question: '¿Cuál es el adjetivo posesivo para "I"?', options: ['Your', 'My', 'His'], answer: 'My' },
                            { type: 'true-false', question: '¿Los adjetivos posesivos van después del sustantivo?', answer: false },
                            { type: 'fill-in-the-blank', question: 'Completa la frase: "This is _____ book." (You)', answer: 'your' },
                            { type: 'multiple-choice', question: 'Si la dueña es una mujer, ¿qué adjetivo posesivo usarías para referirte a su bolso?', options: ['His', 'Her', 'Our'], answer: 'Her' },
                            { type: 'fill-in-the-blank', question: 'Completa la frase: "The dog is wagging _____ tail." (It)', answer: 'its' },
                            { type: 'true-false', question: '¿"Their" se usa para un solo dueño?', answer: false },
                            { type: 'multiple-choice', question: '¿Cuál es el adjetivo posesivo para "We"?', options: ['They', 'Our', 'Your'], answer: 'Our' },
                            { type: 'fill-in-the-blank', question: 'Completa la frase: "_____ name is Pedro." (He)', answer: 'His' },
                            { type: 'true-false', question: '¿"My" solo se usa para singular?', answer: false },
                            { type: 'multiple-choice', question: '¿Qué adjetivo posesivo usarías para hablar del auto de tus amigos?', options: ['Our', 'My', 'Their'], answer: 'Their' }
                        ]
                    },
                    'adjetivos': {
                        title: 'Adjetivos (Adjectives)',
                        content: 'PGgyIHRleHQtMnhsIGZvbnQtc2VtaWJvbGQ+Q29uY2VwdG88L2gyPjxwPk9vbiBwYWxhYnJhcyBxdWUgZGVzY3JpYmVuIHN1c3RhbnRpdm9zLCByZXNwb25kaWVuZG8gYSBsYXMgcHJlZ3VudGFzICImIHF1w6lzaW87IiBvICImIHF1w6lzaXRhOzIiLjwvKD48aDMgY2xhc3M9InRleHQtMnhsIGZvbnQtc2VtaWJvbGQgbXQtNCI+UmVnbGFzIHkgY29uc2Vqb3M8L2gzPjx1bCBjbGFzcz0ibGlzdC1kaXNjIGxpc3QtaW5zaWRlIHNwYWNlLXktMiI+PGxpPjxzY29uZz5V Y2FjaW6yOzwvc3Ryb25nPiBMb3MgYWpldGl2b3Mgc2llbXByZSB2YW4gPHN0cm9uZz5hbnRlczwvc3Ryb25nPiBkZWwgc3VzdGFudGl2byBlbiBpbmcsbOgzIChlamVtcGxvOiBhIDxzdHJvbmc+cmVkPC9zdHJvbmc+IGFwcGxlKS48L2xpPjxsaT48c3Ryb25nPkdldXJhbDo8L3N0cm9uZz4gTm8gdGllbmVuIGZvcm1hIHBsdXJhbC4gU2kgZWwgc3VzdGFudGl2byBlcyBwbHVyYWwsIGVsIGFkamV0aXZvIHNlIG1hbnRpZW5lIGlndWFsIChlamVtcGxvOiB0d28gPHN0cm9uZz5kZWxpY2lvdXM8L3N0cm9uZz4gY29va2llcykuPC9saT48bGk+PHN0cm9uZz5Hw6llcm86PC9zdHJvbmc+IE5vIHRpZW5lbiBnJt25lcm8uIFNlIHVzYW4gZGUgbGEgbWlzbWEgZm9ybWEgcGFyYSBzdXN0YW50aXZvcyBtYXNjdWxpbm9zIG8gZmVtZW5pbm9zIChlamVtcGxvOiBhIDxzdHJvbmc+Z29vZDwvc3Ryb25nPiBtb20sIGEgPHN0cm9uZz5nb29kPC9zdHJvbmc+IGRkZCkuPC9saT48L3VsPjxoMyBjbGFzcz0idGV4dC0yeGwgZm9udC1zZXZpYm9sZCBtdC00Ij5FamVtcGxvsL4gY2xhdmU8L2gzPjx1bCBjbGFzcz0ibGlzdC1kaXNjIGxpc3QtaW5zaWRlIHNwYWNlLXktMiI+PGxpPkEgPHN0cm9uZz5yZWQ8L3N0cm9uZz4gYXBwbGUgKUnaIG1hbnphbmEgcm9qYSk8L2xpPjxsaT5BIHdlcm9uZWdyPl88L3N0cm9uZz4gaGFwcHk8L3N0cm9uZz4gYm95IChVbiBjaGljbyBmZWxpeik8L2xpPjxsaT5NeSBjYXRzIGFyZSA8c3Ryb25nPlx88L3N0cm9uZz4gc21hbGw8L3N0cm9uZz4gKE1pcyBnYXRvcyBzb24gcGVxdWXDsW9zKTwvbGk+PC91bCY+PGRpdiBjbGFzcz0ibXQtNCBmbGV4IGZsZXgtd3JhcCBnYXAtMiI+PGEgaHJlZj0iaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2V4cG9ydD1kb3dubG9hZCZpZD0xamhHby1lZ0oyLVZKangtVkpqTUIyc1RaV0t1eEdmdS1yaUx5RyIgdGFyZ2V0PSJfYmxhbmsiIGNsYXNzPSJicmEtYmx1ZS01MDAgdGV4dC13aGl0ZSBweS0yIHB4LTYgcm91bmRlZC1mdWxsIGZvbnQtc2VtaWJvbGQgaG92ZXI6Ymd-Ymx1ZS02MDAgdHJhbnNpdGlvbiBkdXJhdGlvbi0zMDAgdHJhbnNmb3JtIGhvdmVyOnNjYWxlLTEwNSBpbmluZS1mbGV4IGl0ZW1zLWNlbnRlcj48aSBjbGFzcz0iZmFzIGZhLWRvd25sb2FkIG1yLTIiPjwvaT4gRGVzY2FyZ2FyIGxlY2NpJjM0M248L2E+PGF1ZGlvIGNvbnRyb2xzIGNsYXNzPSJ3LWZ1bGwgbWQ6dy0xLzIiPjxzY29yY2Ugc3JjPSJodHRwczovL2FyY2hpdmUub3JnL2Rvd25sb2FkL3Byb25vbWJyZXNfcGVyc29uYWxlc19jdXJzby9wcm9ub21icmVzX3BlcnNvbmFsZXNfY3Vyc28ubXAzIiB0eXBlPSJhdWRpby9tcGVnIj5UeiBia3ZlZ2Fkb3Igbm8gc29wb3J0YSBlbCBlbGVtZW50byBkZSBhdWRpby48L2F1ZGlvPjxwIGNsYXNzPSJ0ZXh0LXNtIG10LTIgdGV4dC1ncmF5LTUwMCI+QXVkaW86IFByb25vbWJyZXMgUGVyc29uYWxlczwvcD48L2Rpdj4=',
                        quiz: [
                            { type: 'true-false', question: '¿Los adjetivos en inglés se colocan después del sustantivo?', answer: false },
                            { type: 'multiple-choice', question: '¿Qué adjetivo describe a un sustantivo?', options: ['Run', 'Big', 'Quickly'], answer: 'Big' },
                            { type: 'fill-in-the-blank', question: 'Completa la frase: "She has a _____ house." (beautiful)', answer: 'beautiful' },
                            { type: 'true-false', question: '¿Los adjetivos tienen género en inglés?', answer: false },
                            { type: 'multiple-choice', question: '¿Cuál de estos es un adjetivo?', options: ['Walk', 'Car', 'Tall'], answer: 'Tall' },
                            { type: 'fill-in-the-blank', question: 'Completa la frase: "The _____ children are playing." (happy)', answer: 'happy' },
                            { type: 'true-false', question: '¿Los adjetivos en inglés no tienen forma plural?', answer: true },
                            { type: 'multiple-choice', question: '¿Cómo dirías "libros interesantes"?', options: ['Books interesting', 'Interesting books', 'Books are interesting'], answer: 'Interesting books' },
                            { type: 'fill-in-the-blank', question: 'Completa la frase: "The soup is _____." (hot)', answer: 'hot' },
                            { type: 'true-false', question: '¿"Good" es un adjetivo que cambia con el género?', answer: false }
                        ]
                    },
                    'pronombres-demostrativos': {
                        title: 'Pronombres Demostrativos (Demonstrative Pronouns)',
                        content: 'PGgyIHRleHQtMnhsIGZvbnQtc2VtaWJvbGQ+Q29uY2VwdG88L2gyPjxwPlNlIHV0aWxpemFuIHBhcmEgc2XFjWFsYXIgcGVyc29uYXMsIGFuaW1hbGVzIG8gY29zYXMsIGUgaW5kaWNhbiBzaSBlc3RjbiBjZXJjYSBvIGxlam9zLjwvcD48aDMgY2xhc3M9InRleHQtMnhsIGZvbnQtc2VtaWJvbGQgbXQtNCI+UmVnbGFzIHByaW5jaXBhbGVzPC9oMz48dWwgc3RhcnR1bz0iJyciIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgc3BhY2UteS0yIj48bGk+PHN0cm9uZz5DZXRjYTwvY29uZz4gU2UgdXNhIDxzdHJvbmc+dGhpczwvc3Ryb25nPiBwYXJhIHNpbmd1bGFyIHkgPHN0cm9uZz50aGVzZTwvc3Ryb25nPiBwYXJhIHBsdXJhbC48L2xpPjxsaT48c3Ryb25nPkxlanVzOjwvc3Ryb25nPiBTZSB1c2EgPHN0cm9uZz50aGF0PC9zdHJvbmc+IHBhcmEgc2luZ3VsYXIgeSAvdHJvbmc+dGhvc2U8L3N0cm9uZz4gcGFyYSBwbHVyYWwuPC9saT48L3VsPjxoMyBjbGFzcz0idGV4dC0yeGwgZm9udC1zZW1pYm9sZCBtdC00Ij5FamVtcGxvc25sYXZlPC9oMz48dWwgc3RhcnR1bz0iJyciIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgc3BhY2UteS0yIj48bGk+PHN0cm9uZz5UaGlzPC9zdHJvbmc+IGlzIG15IHBlbi4gKEdFPGNncm9uZz4c2VzdGU8L3N0cm9uZz4gZXMgd21pIGJvbGdyYWZvbC4pPC9saT48bGk+PHN0cm9uZz5UaGVzZTwvc3Ryb25nPiBhcmUgbXkgcGVucy4gKGNvbnRyb25nPkVzdG9zPC9zdHJvbmc+IHNvbiBtaXMgYm9sZ3Jhc29zLiE+PC9saT48bGk+PHN0cm9uZz5UaGF0PC9zdHJvbmc+IGlzIGhpcyBzaG9lLiAoc3Ryb25nPkVzZTwvc3Ryb25nPiBlcyBzdSB6YXBhdG8uKTwvbGk+PGxpPjxzdHJvbmc+VGhvc2U8L3N0cm9uZz4gYXJlIGhpcyBzaG9lcy4gKHN0cm9uZz5Fc29zPC9zdHJvbmc+IHNvbiBzdXMgemFwYXRvcy4pPC9saT48L3VsPjxwIGNsYXNzPSJ0ZXh0LXNtIG10LTIgdGV4dC1ncmF5LTUwMCI+QXVkaW86IFByb25vbWJyZXMgUGVyc29uYWxlczwvcD48L2Rpdj4=',
                        quiz: [
                            { type: 'multiple-choice', question: '¿Qué pronombre usarías para señalar un libro que tienes en la mano?', options: ['That', 'These', 'This'], answer: 'This' },
                            { type: 'true-false', question: '¿"Those" se usa para cosas que están lejos y son singulares?', answer: false },
                            { type: 'fill-in-the-blank', question: 'Completa la frase: "I love _____ shirt." (cerca, singular)', answer: 'this' },
                            { type: 'multiple-choice', question: '¿Qué pronombre usarías para hablar de los autos que están lejos?', options: ['These', 'That', 'Those'], answer: 'Those' },
                            { type: 'true-false', question: '¿"This" y "These" se usan para referirse a cosas que están cerca?', answer: true },
                            { type: 'fill-in-the-blank', question: 'Completa la frase: "_____ are my friends." (cerca, plural)', answer: 'These' },
                            { type: 'multiple-choice', question: '¿Cuál es la forma plural de "That"?', options: ['This', 'Those', 'These'], answer: 'Those' },
                            { type: 'true-false', question: '¿"That" se usa para cosas que están lejos?', answer: true },
                            { type: 'fill-in-the-blank', question: 'Completa la frase: "Look at _____ bird over there." (lejos, singular)', answer: 'that' },
                            { type: 'multiple-choice', question: '¿Qué pronombre usarías para hablar de varios libros que están en la mesa de enfrente?', options: ['These', 'Those', 'This'], answer: 'Those' }
                        ]
                    }
                }
            },
            'modulo-3-juego': {
                title: 'Módulo 3: Juego de Memoria',
                description: '¡Pon a prueba tu memoria y vocabulario en este divertido juego de emparejar!',
                color: 'bg-indigo-600',
                game: 'matching-game'
            }
        };

        const blockedModules = [
            'modulo-2-sustantivos-adjetivos',
            'modulo-3-juego'
        ];

        let currentModule = null;
        let currentLesson = null;
        let quizQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let timerId = null;
        let timeLeft = 900; // 10 minutes in seconds

        const mainMenu = document.getElementById('main-menu');
        const moduleList = document.getElementById('module-list');
        const moduleView = document.getElementById('module-view');
        const moduleTitle = document.getElementById('module-title');
        const moduleDescription = document.getElementById('module-description');
        const moduleMedia = document.getElementById('module-media');
        const lessonList = document.getElementById('lesson-list');
        const lessonTemplate = document.getElementById('lesson-template');
        const quizTemplate = document.getElementById('quiz-template');
        const quizQuestionsContainer = document.getElementById('quiz-questions');
        const feedbackMessageElement = document.getElementById('feedback-message');
        const progressText = document.getElementById('progress-text');
        const progressBar = document.getElementById('progress-bar');
        const quizResults = document.getElementById('quiz-results');
        const scoreText = document.getElementById('score-text');
        const timerElement = document.getElementById('timer');
        const blockedModal = document.getElementById('blocked-modal');
        const adminButton = document.getElementById('admin-button');
        const adminModal = document.getElementById('admin-modal');
        const unlockButton = document.getElementById('unlock-button');
        const adminPasswordInput = document.getElementById('admin-password-input');
        const adminMessage = document.getElementById('admin-message');
        const matchingGameTemplate = document.getElementById('matching-game-template');
        const shareButton = document.getElementById('share-button');
        const adminPanel = document.getElementById('admin-panel');
        const changePasswordButton = document.getElementById('change-password-button');
        const changePasswordModal = document.getElementById('change-password-modal');
        const oldPasswordInput = document.getElementById('old-password-input');
        const newPasswordInput = document.getElementById('new-password-input');
        const confirmPasswordInput = document.getElementById('confirm-password-input');
        const savePasswordButton = document.getElementById('save-password-button');
        const passwordChangeMessage = document.getElementById('password-change-message');

        const initialAdminPassword = "Douglas"; // Contraseña predeterminada en el código
        let currentAdminPassword = initialAdminPassword;
        let isAllModulesUnlocked = false;
        let userProgress = {};
        
        let passwordChangeAttempts = 0;
        let lastAttemptTime = 0;
        const ATTEMPT_LIMIT = 3;
        const LOCKOUT_TIME = 60000; // 1 minuto en milisegundos


        function saveProgress() {
            sessionStorage.setItem('isAllModulesUnlocked', isAllModulesUnlocked);
            sessionStorage.setItem('currentAdminPassword', currentAdminPassword);
        }

        function loadProgress() {
            isAllModulesUnlocked = sessionStorage.getItem('isAllModulesUnlocked') === 'true';
            const storedPassword = sessionStorage.getItem('currentAdminPassword');
            if (storedPassword) {
                currentAdminPassword = storedPassword;
            } else {
                currentAdminPassword = initialAdminPassword;
            }
        }
        
        function getLessonContent(moduleId, lessonId) {
            const lesson = modules[moduleId].lessons[lessonId];
            if (lesson && typeof lesson.content === 'string') {
                try {
                    return decrypt(lesson.content, currentAdminPassword);
                } catch (e) {
                    console.error("Failed to decrypt content:", e);
                    return '';
                }
            }
            return lesson.content;
        }

        function toggleModuleBlocked(moduleId, isBlocked) {
            const moduleCard = document.querySelector(`.module-card[data-id="${moduleId}"]`);
            if (moduleCard) {
                if (isBlocked) {
                    moduleCard.classList.add('opacity-50', 'cursor-not-allowed');
                    const overlay = moduleCard.querySelector('.block-overlay');
                    if (overlay) {
                        overlay.classList.remove('hidden');
                    }
                } else {
                    moduleCard.classList.remove('opacity-50', 'cursor-not-allowed');
                    const overlay = moduleCard.querySelector('.block-overlay');
                    if (overlay) {
                        overlay.classList.add('hidden');
                    }
                }
            }
        }
        
        function showMainMenu() {
            hideAllViews();
            mainMenu.classList.remove('hidden');
            if (isAllModulesUnlocked) {
                adminButton.classList.add('hidden');
                adminPanel.classList.remove('hidden');
            } else {
                adminButton.classList.remove('hidden');
                adminPanel.classList.add('hidden');
            }
            renderModules();
        }

        function renderModules() {
            moduleList.innerHTML = '';
            const moduleKeys = Object.keys(modules);
            moduleKeys.forEach(key => {
                const module = modules[key];
                const moduleCard = document.createElement('div');
                moduleCard.className = `relative module-card p-6 text-center transform transition duration-300 hover:scale-105 hover:shadow-xl cursor-pointer ${module.color || 'bg-gray-100'}`;
                moduleCard.dataset.id = key;

                const isBlocked = !isAllModulesUnlocked && blockedModules.includes(key);
                const isDarkBackground = ['bg-indigo-600', 'bg-teal-500', 'bg-green-600', 'bg-red-500', 'bg-orange-500', 'bg-pink-500', 'bg-purple-600'].includes(module.color);
                
                moduleCard.innerHTML = `
                    <div class="space-y-4">
                        <i class="fas fa-book-open text-4xl ${isDarkBackground ? 'text-white' : 'text-gray-600'}"></i>
                        <h3 class="text-2xl font-bold ${isDarkBackground ? 'text-white' : 'text-gray-800'}">${module.title}</h3>
                        <p class="text-gray-600 ${isDarkBackground ? 'text-white' : 'text-gray-600'}">${module.description}</p>
                    </div>
                    ${isBlocked ? '<div class="absolute inset-0 bg-white bg-opacity-70 flex items-center justify-center rounded-lg block-overlay"><i class="fas fa-lock text-4xl text-red-500"></i></div>' : ''}
                `;

                if (isBlocked) {
                    moduleCard.onclick = () => showBlockedMessage();
                } else {
                    moduleCard.onclick = () => showModule(key);
                }

                moduleList.appendChild(moduleCard);
            });
        }

        function showModule(moduleId) {
            currentModule = moduleId;
            const module = modules[currentModule];

            if (module.game) {
                hideAllViews();
                matchingGameTemplate.classList.remove('hidden');
                setupMatchingGame();
                return;
            }
            
            hideAllViews();
            moduleView.classList.remove('hidden');
            moduleTitle.textContent = module.title;
            moduleDescription.textContent = module.description;
            renderModuleMedia(module.media);
            renderLessons(module.lessons);
        }
        
        function renderMedia(media, container) {
            container.innerHTML = '';
            if (media && media.document) {
                if (Array.isArray(media.document)) {
                    media.document.forEach(doc => {
                        const docLink = document.createElement('a');
                        docLink.href = doc.url;
                        docLink.className = 'mr-2 bg-gray-200 text-gray-800 py-2 px-4 rounded-full inline-flex items-center hover:bg-gray-300 transition duration-300';
                        docLink.innerHTML = `<i class="fas fa-file-pdf mr-2"></i> ${doc.name}`;
                        docLink.target = '_blank';
                        container.appendChild(docLink);
                    });
                } else {
                    const docLink = document.createElement('a');
                    docLink.href = media.document.url;
                    docLink.className = 'mr-2 bg-orange-200 text-orange-800 py-2 px-4 rounded-full inline-flex items-center hover:bg-orange-300 transition duration-300';
                    docLink.innerHTML = `<i class="fas fa-file-pdf mr-2"></i> ${media.document.name}`;
                    docLink.target = '_blank';
                    container.appendChild(docLink);
                }
            }
            if (media && media.audio) {
                const audioLink = document.createElement('a');
                audioLink.href = media.audio.url;
                audioLink.className = 'ml-4 bg-gray-200 text-gray-800 py-2 px-4 rounded-full inline-flex items-center hover:bg-gray-300 transition duration-300';
                audioLink.innerHTML = `<i class="fas fa-volume-up mr-2"></i> ${media.audio.name}`;
                audioLink.target = '_blank';
                container.appendChild(audioLink);
            }
        }

        function renderModuleMedia(media) {
            moduleMedia.innerHTML = '';
            if (media && media.image) {
                const img = document.createElement('img');
                img.src = media.image;
                img.alt = media.title;
                img.className = 'w-full max-h-64 object-cover rounded-lg mb-4';
                moduleMedia.appendChild(img);
            }
            renderMedia(media, moduleMedia);
        }

        function renderLessons(lessons) {
            lessonList.innerHTML = '';
            const lessonColors = ['bg-blue-500', 'bg-green-500', 'bg-yellow-500', 'bg-red-500', 'bg-purple-500', 'bg-teal-500'];
            const lessonKeys = Object.keys(lessons);
            lessonKeys.forEach((key, i) => {
                const lesson = lessons[key];
                const lessonCard = document.createElement('div');
                const color = lessonColors[i % lessonColors.length];
                lessonCard.className = `card p-6 text-center transform transition duration-300 hover:scale-105 hover:shadow-xl cursor-pointer ${color} text-white`;
                lessonCard.innerHTML = `
                    <i class="fas fa-graduation-cap text-3xl text-white mb-2"></i>
                    <h4 class="text-xl font-semibold">${lesson.title}</h4>
                `;
                lessonCard.onclick = () => showLesson(key);
                lessonList.appendChild(lessonCard);
            });
        }

        function showLesson(lessonId) {
            currentLesson = lessonId;
            const lesson = modules[currentModule].lessons[currentLesson];
            hideAllViews();
            const lessonView = lessonTemplate.cloneNode(true);
            lessonView.id = 'lesson-view';
            lessonView.classList.remove('hidden');
            lessonView.querySelector('#lesson-title').textContent = lesson.title;

            // Decrypt and set content
            const lessonContent = getLessonContent(currentModule, currentLesson);
            lessonView.querySelector('#lesson-content').innerHTML = lessonContent;
            
            const quizButton = lessonView.querySelector('#show-quiz-button');
            if (quizButton) {
                if (lesson.quiz) {
                    quizButton.onclick = () => showQuiz();
                    quizButton.classList.remove('hidden');
                } else {
                    quizButton.classList.add('hidden');
                }
            }
            
            const backButton = lessonView.querySelector('#back-to-modules-button');
            if (backButton) {
                backButton.onclick = () => showModule(currentModule);
            }
            
            const lessonMediaContainer = lessonView.querySelector('#lesson-media-container');
            renderMedia(lesson.media, lessonMediaContainer);

            document.getElementById('app-container').appendChild(lessonView);
        }

        function showQuiz() {
            const quiz = modules[currentModule].lessons[currentLesson].quiz;
            if (!quiz) {
                alert('No hay quiz para esta lección.');
                return;
            }
            quizQuestions = quiz;
            currentQuestionIndex = 0;
            score = 0;
            hideAllViews();
            const quizView = quizTemplate.cloneNode(true);
            quizView.id = 'quiz-view';
            quizView.classList.remove('hidden');
            quizView.querySelector('#quiz-title').textContent = `Quiz: ${modules[currentModule].lessons[currentLesson].title}`;

            const backButton = quizView.querySelector('#back-to-lesson-button');
            if (backButton) {
                backButton.onclick = () => showLesson(currentLesson);
            }

            document.getElementById('app-container').appendChild(quizView);
            startTimer();
            renderQuestion();
        }

        function renderQuestion() {
            const questionData = quizQuestions[currentQuestionIndex];
            const quizView = document.getElementById('quiz-view');
            if (!quizView) return;
            
            const quizQuestionsContainer = quizView.querySelector('#quiz-questions');
            const feedbackMessageElement = quizView.querySelector('#feedback-message');
            if (!quizQuestionsContainer || !feedbackMessageElement) return;

            quizQuestionsContainer.innerHTML = '';
            feedbackMessageElement.textContent = ''; // Clear previous feedback

            const questionElement = document.createElement('div');
            questionElement.className = 'bg-white p-6 rounded-lg shadow-md space-y-4';
            questionElement.innerHTML = `<p class="text-lg font-medium">${currentQuestionIndex + 1}. ${questionData.question}</p>`;
            
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'space-y-2';

            if (questionData.type === 'multiple-choice') {
                questionData.options.forEach(option => {
                    const optionButton = document.createElement('button');
                    optionButton.textContent = option;
                    optionButton.className = 'quiz-option w-full text-left py-3 px-4 bg-gray-100 rounded-lg border-2 border-transparent hover:border-blue-500';
                    optionButton.onclick = () => checkAnswer(option, questionData.answer, optionButton);
                    optionsContainer.appendChild(optionButton);
                });
            } else if (questionData.type === 'true-false') {
                const trueButton = document.createElement('button');
                trueButton.textContent = 'Verdadero';
                trueButton.className = 'quiz-option w-full text-left py-3 px-4 bg-gray-100 rounded-lg border-2 border-transparent hover:border-blue-500';
                trueButton.onclick = () => checkAnswer(true, questionData.answer, trueButton);
                optionsContainer.appendChild(trueButton);
                
                const falseButton = document.createElement('button');
                falseButton.textContent = 'Falso';
                falseButton.className = 'quiz-option w-full text-left py-3 px-4 bg-gray-100 rounded-lg border-2 border-transparent hover:border-blue-500';
                falseButton.onclick = () => checkAnswer(false, questionData.answer, falseButton);
                optionsContainer.appendChild(falseButton);
            } else if (questionData.type === 'fill-in-the-blank') {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'w-full py-2 px-4 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500';
                input.placeholder = 'Escribe tu respuesta aquí...';
                const submitButton = document.createElement('button');
                submitButton.textContent = 'Enviar Respuesta';
                submitButton.className = 'bg-blue-500 text-white py-2 px-4 rounded-full mt-2 hover:bg-blue-600 transition duration-300';
                submitButton.onclick = () => checkAnswer(input.value.toLowerCase().trim(), questionData.answer.toLowerCase().trim(), submitButton);
                optionsContainer.appendChild(input);
                optionsContainer.appendChild(submitButton);
            }
            
            questionElement.appendChild(optionsContainer);
            quizQuestionsContainer.appendChild(questionElement);
            updateProgressBar();
        }
        
        function checkAnswer(userAnswer, correctAnswer, button) {
            const quizView = document.getElementById('quiz-view');
            if (!quizView) return;

            const feedbackMessageElement = quizView.querySelector('#feedback-message');
            const isCorrect = String(userAnswer).toLowerCase().trim() === String(correctAnswer).toLowerCase().trim();
            
            const quizQuestionsContainer = quizView.querySelector('#quiz-questions');
            if (!quizQuestionsContainer) return;

            Array.from(quizQuestionsContainer.querySelectorAll('.quiz-option, button[type="submit"]')).forEach(btn => {
                btn.disabled = true;
                btn.classList.add('cursor-not-allowed', 'opacity-50');
            });

            if (isCorrect) {
                score++;
                if (button) {
                    button.classList.add('bg-green-500', 'text-white');
                    button.classList.remove('bg-gray-100', 'hover:border-blue-500');
                }
                if (feedbackMessageElement) {
                    feedbackMessageElement.textContent = '¡Genial! ¡Respuesta correcta!';
                    feedbackMessageElement.className = 'mt-4 text-center text-lg font-bold text-green-600';
                }
            } else {
                if (button) {
                    button.classList.add('bg-red-500', 'text-white');
                    button.classList.remove('bg-gray-100', 'hover:border-blue-500');
                }
                if (feedbackMessageElement) {
                    feedbackMessageElement.innerHTML = `¡Incorrecto! La respuesta correcta era: <span class="text-blue-600">${correctAnswer}</span>`;
                    feedbackMessageElement.className = 'mt-4 text-center text-lg font-bold text-red-600';
                }
            }
            
            if (!isCorrect) {
                const correctButton = Array.from(quizQuestionsContainer.querySelectorAll('.quiz-option')).find(btn => String(btn.textContent).toLowerCase().trim() === String(correctAnswer).toLowerCase().trim());
                if (correctButton) {
                    correctButton.classList.add('bg-green-500', 'text-white');
                }
            }

            setTimeout(() => {
                currentQuestionIndex++;
                if (currentQuestionIndex < quizQuestions.length) {
                    renderQuestion();
                } else {
                    endQuiz();
                }
            }, 1500);
        }

        function updateProgressBar() {
            const quizView = document.getElementById('quiz-view');
            if (quizView) {
                const progressText = quizView.querySelector('#progress-text');
                const progressBar = quizView.querySelector('#progress-bar');
                
                const progressPercentage = (currentQuestionIndex / quizQuestions.length) * 100;
                if (progressBar) progressBar.style.width = `${progressPercentage}%`;
                if (progressText) progressText.textContent = `${currentQuestionIndex}/${quizQuestions.length}`;
            }
        }
        
        function startTimer() {
            if (timerId) clearInterval(timerId);
            timeLeft = 900;
            const timerElement = document.getElementById('timer');
            if (timerElement) timerElement.textContent = formatTime(timeLeft);
            timerId = setInterval(() => {
                timeLeft--;
                if (timerElement) timerElement.textContent = formatTime(timeLeft);
                if (timeLeft <= 0) {
                    clearInterval(timerId);
                    endQuiz();
                }
            }, 1000);
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 90);
            const remainingSeconds = seconds % 90;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function endQuiz() {
            clearInterval(timerId);
            
            const quizView = document.getElementById('quiz-view');
            if (quizView) {
                const quizQuestionsContainer = quizView.querySelector('#quiz-questions');
                const progressContainer = quizView.querySelector('#progress-container');
                const timerContainer = quizView.querySelector('#timer-container');
                const feedbackMessage = quizView.querySelector('#feedback-message');
                const quizResults = quizView.querySelector('#quiz-results');
                const scoreText = quizView.querySelector('#score-text');

                if (quizQuestionsContainer) quizQuestionsContainer.classList.add('hidden');
                if (progressContainer) progressContainer.classList.add('hidden');
                if (timerContainer) timerContainer.classList.add('hidden');
                if (feedbackMessage) feedbackMessage.classList.add('hidden');
                if (quizResults) quizResults.classList.remove('hidden');
                
                const percentage = (score / quizQuestions.length) * 100;
                if (scoreText) scoreText.innerHTML = `Tu puntuación es: <span class="font-bold text-blue-600">${score} / ${quizQuestions.length}</span> (${percentage.toFixed(0)}%)`;

                if (!userProgress[currentModule]) {
                    userProgress[currentModule] = {};
                }
                userProgress[currentModule][currentLesson] = {
                    score: score,
                    total: quizQuestions.length,
                    passed: percentage >= 70
                };
                saveProgress();
            }
        }

        function hideAllViews() {
            const views = [mainMenu, moduleView, lessonTemplate, quizTemplate, matchingGameTemplate];
            views.forEach(view => view.classList.add('hidden'));
            const dynamicViews = document.querySelectorAll('#lesson-view, #quiz-view');
            dynamicViews.forEach(view => view.remove());
        }

        function showBlockedMessage() {
            blockedModal.classList.remove('hidden');
        }

        function hideBlockedMessage() {
            blockedModal.classList.add('hidden');
        }

        function showAdminModal() {
            adminModal.classList.remove('hidden');
        }

        function hideAdminModal() {
            adminModal.classList.add('hidden');
        }
        
        function unlockModules() {
            const password = adminPasswordInput.value;
            if (password === currentAdminPassword) {
                isAllModulesUnlocked = true;
                saveProgress();
                hideAdminModal();
                showMainMenu();
                adminMessage.classList.add('hidden');
            } else {
                adminMessage.textContent = 'Contraseña incorrecta. Inténtalo de nuevo.';
                adminMessage.className = 'text-red-500 text-sm mt-2';
                adminMessage.classList.remove('hidden');
            }
        }
        
        function showPasswordModal() {
            changePasswordModal.classList.remove('hidden');
            oldPasswordInput.value = '';
            newPasswordInput.value = '';
            confirmPasswordInput.value = '';
            passwordChangeMessage.classList.add('hidden');
        }

        function hidePasswordModal() {
            changePasswordModal.classList.add('hidden');
        }

        function changePassword() {
            const now = Date.now();
            if (passwordChangeAttempts >= ATTEMPT_LIMIT && (now - lastAttemptTime) < LOCKOUT_TIME) {
                passwordChangeMessage.textContent = 'Demasiados intentos. Espera un momento antes de volver a intentarlo.';
                passwordChangeMessage.className = 'text-yellow-600 text-sm mt-2';
                passwordChangeMessage.classList.remove('hidden');
                return;
            }

            const oldPassword = oldPasswordInput.value;
            const newPassword = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            if (oldPassword !== currentAdminPassword) {
                passwordChangeMessage.textContent = 'La contraseña actual es incorrecta.';
                passwordChangeMessage.className = 'text-red-500 text-sm mt-2';
                passwordChangeMessage.classList.remove('hidden');
                passwordChangeAttempts++;
                lastAttemptTime = now;
                return;
            }

            if (newPassword !== confirmPassword) {
                passwordChangeMessage.textContent = 'La nueva contraseña y la confirmación no coinciden.';
                passwordChangeMessage.className = 'text-red-500 text-sm mt-2';
                passwordChangeMessage.classList.remove('hidden');
                return;
            }

            if (newPassword.length < 8) {
                passwordChangeMessage.textContent = 'La nueva contraseña debe tener al menos 8 caracteres.';
                passwordChangeMessage.className = 'text-red-500 text-sm mt-2';
                passwordChangeMessage.classList.remove('hidden');
                return;
            }

            if (newPassword === currentAdminPassword) {
                passwordChangeMessage.textContent = 'La nueva contraseña no puede ser la misma que la actual.';
                passwordChangeMessage.className = 'text-red-500 text-sm mt-2';
                passwordChangeMessage.classList.remove('hidden');
                return;
            }

            currentAdminPassword = newPassword;
            saveProgress();
            
            passwordChangeMessage.textContent = 'Contraseña cambiada exitosamente.';
            passwordChangeMessage.className = 'text-green-600 text-sm mt-2';
            passwordChangeMessage.classList.remove('hidden');
            passwordChangeAttempts = 0; // Reset attempts on success
            
            setTimeout(() => {
                hidePasswordModal();
            }, 1000);
        }
        
        function shareCourse() {
            const courseUrl = window.location.href;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(courseUrl).then(() => {
                    alert('¡Enlace del curso copiado al portapapeles!');
                }).catch(err => {
                    console.error('Error al copiar el enlace:', err);
                    alert('No se pudo copiar el enlace. Por favor, cópialo manualmente: ' + courseUrl);
                });
            } else {
                alert('Tu navegador no soporta la función de copiado. Por favor, copia el enlace manualmente: ' + courseUrl);
            }
        }

        // Memory Game Logic
        const cardContainer = document.getElementById('card-container');
        let flippedCards = [];
        let matchedPairs = 0;
        let lockBoard = false;
        
        const vocabularyForGame = [
            { en: 'Hello', es: 'Hola' },
            { en: 'Goodbye', es: 'Adiós' },
            { en: 'Water', es: 'Agua' },
            { en: 'Food', es: 'Comida' },
            { en: 'Book', es: 'Libro' },
            { en: 'Pen', es: 'Bolígrafo' },
            { en: 'House', es: 'Casa' },
            { en: 'Car', es: 'Carro' },
            { en: 'Dog', es: 'Perro' },
            { en: 'Cat', es: 'Gato' }
        ];

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function setupMatchingGame() {
            cardContainer.innerHTML = '';
            matchedPairs = 0;
            const gameCards = shuffle([...vocabularyForGame, ...vocabularyForGame]);

            gameCards.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card-game relative';
                card.dataset.pair = item.en;
                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front"><span class="text-3xl font-bold">${item.en}</span></div>
                        <div class="card-back"><span class="text-3xl font-bold">${item.es}</span></div>
                    </div>
                `;
                
                card.addEventListener('click', () => flipCard(card));
                cardContainer.appendChild(card);
            });
        }
        
        function flipCard(card) {
            if (lockBoard) return;
            if (card.classList.contains('matched')) return;
            if (flippedCards.length < 2) {
                card.classList.add('flipped');
                flippedCards.push(card);
            }
            
            if (flippedCards.length === 2) {
                lockBoard = true;
                checkForMatch();
            }
        }
        
        function checkForMatch() {
            const [card1, card2] = flippedCards;
            const isMatch = card1.dataset.pair === card2.dataset.pair;
            
            if (isMatch) {
                card1.classList.add('matched');
                card2.classList.add('matched');
                matchedPairs++;
                if (matchedPairs === vocabularyForGame.length) {
                    setTimeout(() => {
                        const winMessage = document.createElement('div');
                        winMessage.className = 'text-center mt-6 text-2xl font-bold text-green-700';
                        winMessage.textContent = '¡Felicidades, has encontrado todas las parejas!';
                        cardContainer.appendChild(winMessage);
                    }, 500);
                }
                resetBoard();
            } else {
                setTimeout(() => {
                    card1.classList.remove('flipped');
                    card2.classList.remove('flipped');
                    resetBoard();
                }, 1000);
            }
        }

        function resetBoard() {
            flippedCards = [];
            lockBoard = false;
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            loadProgress();
            showMainMenu();
            unlockButton.addEventListener('click', unlockModules);
            adminPasswordInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    unlockModules();
                }
            });
            adminButton.addEventListener('click', showAdminModal);
            shareButton.addEventListener('click', shareCourse);
            changePasswordButton.addEventListener('click', showPasswordModal);
            savePasswordButton.addEventListener('click', changePassword);
            newPasswordInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    changePassword();
                }
            });
            confirmPasswordInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    changePassword();
                }
            });
        });
    </script>
</body>
</html>
